//
//  MarketDataMode.swift
//  CryptoTrackerSwiftUI
//
//  Created by Sabr on 25.05.2024.
//

import Foundation

/// JSON Response
/*
 URL: https:api.coingecko.com/api/v3/global
{"data":{
    "active_cryptocurrencies":14446,
    "upcoming_icos":0,
    "ongoing_icos":49,
    "ended_icos":3376,
    "markets":1103,
    "total_market_cap":{
        "btc":39078209.22101989,
        "eth":721287344.1986489,
        "ltc":31578978696.275658,
        "bch":5420662822.299471,
        "bnb":4479569142.480991,
        "eos":3220686428987.4004,
        "xrp":5055835106064.584,
        "xlm":24546392491874.168,
        "link":156679247192.96167,
        "dot":372503139417.5052,
        "yfi":380216180.1620404,
        "usd":2694598908409.203,
        "aed":9896992330696.152,
        "ars":2400214247125390.5,
        "aud":4065174307984.6426,
        "bdt":315833994641220.06,
        "bhd":1015610496172.8802,
        "bmd":2694598908409.203,
        "brl":13920028500951.1,
        "cad":3682492760210.1855,
        "chf":2464676867351.3706,
        "clp":2443004208331035.5,
        "cny":19160147633161.77,
        "czk":61203772306152.38,
        "dkk":18533181832147.656,
        "eur":2484064506497.3745,
        "gbp":2115551159783.3347,
        "gel":7302363041788.937,
        "hkd":21051149782110.668,
        "huf":954036216516819.1,
        "idr":4.320708511666903e+16,
        "ils":9859496986885.652,
        "inr":223812525755416.53,
        "jpy":422910562177552.4,
        "krw":3.681317820775159e+15,
        "kwd":827279589266.3442,
        "lkr":806598938750342.9,
        "mmk":5.654493824804112e+15,
        "mxn":44983499447037.79,
        "myr":12676740564611.104,
        "ngn":3956910713042574.5,
        "nok":28552926616116.4,
        "nzd":4401322827209.798,
        "php":156796013186824.47,
        "pkr":749044437494459.1,
        "pln":10562304968775.85,
        "rub":241451515718204.53,
        "sar":10106570149995.516,
        "sek":28743556015891.84,
        "sgd":3637115714592.5757,
        "thb":98703158015029.28,
        "try":86837763876338.98,
        "twd":86907556682665.61,
        "uah":108075048467245.64,
        "vef":269810188699.0137,
        "vnd":6.863471939019569e+16,
        "zar":49639992707077.375,
        "xdr":2033937148045.4365,
        "xag":88807863281.64543,
        "xau":1154285334.39525,
        "bits":39078209221019.88,
        "sats":3907820922101988.5},
    "total_volume":{"btc":1700112.114791873,"eth":31379875.807066847,"ltc":1373855284.6841924,"bch":235827964.43589738,"bnb":194885331.74860296,"eos":140117168238.14966,"xrp":219955998126.62354,"xlm":1067899990346.1392,"link":6816389276.762073,"dot":16205888466.89169,"yfi":16541447.190616783,"usd":117229533799.29424,"aed":430572354691.42737,"ars":104422218954674.8,"aud":176856929411.89963,"bdt":13740476118435.5,"bhd":44184514666.156845,"bmd":117229533799.29424,"brl":605596048653.7739,"cad":160208225480.7915,"chf":107226689368.80183,"clp":106283812228454.11,"cny":833569392294.9167,"czk":2662693015950.2676,"dkk":806293010518.1658,"eur":108070155864.48775,"gbp":92037844822.09639,"gel":317692036596.0872,"hkd":915838148376.9176,"huf":41505702589309.07,"idr":1879740405611542.5,"ils":428941105728.61084,"inr":9737047681148.094,"jpy":18398882255964.688,"krw":160157109301021.4,"kwd":35991108089.856575,"lkr":35091388650688.445,"mmk":246000869696823.1,"mxn":1957023975768.727,"myr":551506341758.78,"ngn":172146881202911.47,"nok":1242205756621.8203,"nzd":191481196523.82846,"php":6821469225017.609,"pkr":32587458537296.766,"pln":459517029963.6766,"rub":10504438539793.111,"sar":439690116141.736,"sek":1250499159990.453,"sgd":158234080131.61145,"thb":4294117823068.156,"try":3777909411165.872,"twd":3780945773320.8037,"uah":4701845424049.035,"vef":11738193219.323341,"vnd":2.98597914941935e+15,"zar":2159606457454.754,"xdr":88487196702.38336,"xag":3863619322.9830217,"xau":50217615.39360366,"bits":1700112114791.8728,"sats":170011211479187.28},
    "market_cap_percentage":{"btc":50.419490536434,"eth":16.67805633810496,"usdt":4.154404280775771,"bnb":3.4352526287936005,"sol":2.8011320191476052,"steth":1.2896554184569085,"usdc":1.2125756957698666,"xrp":1.09736789753825,"doge":0.8843244955971049,"ton":0.8194327375278878},
    "market_cap_change_percentage_24h_usd":1.7263925150427966,
    "updated_at":1716583816}}
*/
struct GlobalData: Codable {
    let data: MarketDataModel?
}

struct MarketDataModel: Codable {
    let totalMarketCap, totalVolume, marketCapPercentage: [String: Double]
    let marketCapChangePercentage24HUsd: Double?
    
    enum CodingKeys: String, CodingKey {
        case totalMarketCap = "total_market_cap"
        case totalVolume = "total_volume"
        case marketCapPercentage = "market_cap_percentage"
        case marketCapChangePercentage24HUsd = "market_cap_change_percentage_24h_usd"
    }
    
    var volume: String {
        if let item = totalVolume.first(where: { ($0.key == "btc")}) {
            return "$\(item.value.formattedWithAbbreviations())"
        }
        return ""
    }
    
    var marketCap: String {
        if let item = totalMarketCap.first(where: { ($0.key == "usd")}) {
            return "$\(item.value.formattedWithAbbreviations())"
        }
        return ""
    }
    
    var btcDominance: String {
        if let item = marketCapPercentage.first(where: { ($0.key == "btc")}) {
            return item.value.asPercentString()
        }
        return ""
    }
}
